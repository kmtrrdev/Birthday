<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Happy Birthday, Habuba! üéâ</title>
<style>
  *{box-sizing:border-box}
  :root{
    --pink:#ff69b4; --red:#e53935; --fg:#fff;
    --bg1:#2b1b47; --bg2:#1a0f2e;
    --paper:#fffdf6;
  }
  body{
    margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Poppins",sans-serif;
    background: radial-gradient(1200px 600px at 50% 0%, var(--bg1) 0%, var(--bg2) 60%);
    color:var(--fg); min-height:100vh; display:flex; flex-direction:column;
    align-items:center; justify-content:center; overflow:hidden; text-align:center;
    transition: filter 0.5s ease;
  }

  /* Neon glow helpers */
  @keyframes neonPulse {
    0%,100% { text-shadow: 0 0 6px rgba(255,255,255,.7), 0 0 14px rgba(255,105,180,.9), 0 0 28px rgba(255,105,180,.6); }
    50%     { text-shadow: 0 0 8px rgba(255,255,255,.9), 0 0 18px rgba(255,105,180,1), 0 0 36px rgba(255,105,180,.9); }
  }
  .glow { animation: neonPulse 2.2s ease-in-out infinite; }

  h1{font-size:2rem; margin:18px 12px 8px; transition: all 0.3s ease;}
  h1:hover { transform: scale(1.05); text-shadow: 0 0 20px rgba(255, 105, 180, 0.8); }
  
  .buttons{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
  button{
    padding:10px 20px;font-size:1.05rem;border:none;border-radius:10px;cursor:pointer;transition:.25s; 
    position: relative; overflow: hidden;
    text-shadow: 0 0 6px rgba(255,255,255,.6), 0 0 12px rgba(255,105,180,.7);
  }
  button::before{
    content:''; position:absolute; top:50%; left:50%; width:0; height:0;
    background:rgba(255,255,255,.3); border-radius:50%;
    transition:width .3s ease, height .3s ease; transform:translate(-50%,-50%);
  }
  button:hover::before{width:300px;height:300px}
  #yesBtn{background:var(--pink);color:#fff} #yesBtn:hover{transform:scale(1.06)}
  #noBtn{background:var(--red);color:#fff}
  .message{margin-top:10px;font-size:1.15rem;white-space:pre-line; animation: fadeIn 1s ease;
    text-shadow: 0 0 6px rgba(255,255,255,.6), 0 0 12px rgba(255,105,180,.7);}
  @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

  /* Heart rain */
  .heart-rain{
    position:fixed; z-index:100; pointer-events:none; width:18px;height:18px;transform:rotate(45deg);
    background:red; animation:fallHeart linear forwards; border-radius:2px; filter:drop-shadow(0 0 6px rgba(255,0,0,.6));
  }
  .heart-rain::before,.heart-rain::after{content:'';position:absolute;width:18px;height:18px;background:inherit;border-radius:50%}
  .heart-rain::before{top:-9px;left:0}.heart-rain::after{left:-9px;top:0}
  @keyframes fallHeart{0%{transform:translateY(-10vh) rotate(45deg) scale(0);opacity:0}5%{opacity:.95; transform:translateY(-5vh) rotate(45deg) scale(1)}100%{transform:translateY(110vh) rotate(405deg) scale(.5);opacity:0}}

  /* Bottom heart */
  .heart-container{
    position:fixed; bottom:80px; left:50%; transform:translateX(-50%);
    z-index:200; display:none; width:280px; height:320px;
  }
  .heart-shell{position:relative; width:280px; height:252px; cursor:pointer; z-index:2; transition:all .3s ease; animation:heartPulse 2s ease-in-out infinite}
  .heart-shell:hover{transform:scale(1.05); filter:drop-shadow(0 10px 25px rgba(255,105,180,.6))}
  .heart-shell::before,.heart-shell::after{
    content:""; position:absolute; width:140px; height:224px;
    background:linear-gradient(145deg,#ff69b4,#ff1493); border-radius:140px 140px 0 0; top:0;
    box-shadow:inset 0 0 20px rgba(255,255,255,.3), 0 5px 15px rgba(0,0,0,.3);
  }
  .heart-shell::before{left:140px; transform:rotate(-45deg); transform-origin:0 100%}
  .heart-shell::after{left:0; transform:rotate(45deg); transform-origin:100% 100%}
  @keyframes heartPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

  .note{
    position:absolute; bottom:0; left:50%; transform:translateX(-50%) translateY(120%);
    width:240px; height:280px; background:var(--paper); border-radius:10px; color:#333; padding:20px;
    box-shadow:0 8px 20px rgba(0,0,0,.4); transition:transform .8s cubic-bezier(.4,0,.2,1); transform-origin:bottom center; z-index:1;
  }
  .note.open{ transform:translateX(-50%) translateY(-20%) }
  .note-content{font-size:16px; text-align:center; line-height:1.4}
  .note-content h3{margin:0 0 15px 0; font-size:20px; color:#d63384}
  .note-content p{margin:8px 0}
  .paper-tip-indicator{position:absolute; top:-40px; left:50%; transform:translateX(-50%); font-size:14px; color:rgba(255,255,255,.7); opacity:1; transition:opacity .3s ease; pointer-events:none}

  /* Overlay ‚Äî adds blur to background when active */
  .big-heart-overlay{
    position:fixed; inset:0; 
    background:rgba(0,0,0,.5);
    backdrop-filter: blur(15px);           /* <-- BLUR */
    -webkit-backdrop-filter: blur(15px);   /* Safari support */
    z-index:10000; display:none; align-items:center; justify-content:center; opacity:0;
    transition:opacity .5s cubic-bezier(.4,0,.2,1); padding:20px; box-sizing:border-box;
    pointer-events:auto;
  }
  .big-heart-overlay.active{display:flex; opacity:1}

  /* BIG HEART ‚Äî centered */
  .big-heart-shell{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%) scale(.3) rotate(-10deg);
    width:min(92vw, 520px);
    aspect-ratio: 1 / 0.9;
    max-width:520px;
    cursor:default;
    transition:transform .6s cubic-bezier(.2,.8,.2,1);
    animation:bigHeartFloat 4s ease-in-out infinite;
    contain:layout paint;
    pointer-events:auto;
  }
  .big-heart-overlay.active .big-heart-shell{
    transform:translate(-50%,-50%) scale(1) rotate(0deg);
    animation: bigHeartFloat 4s ease-in-out infinite, bigHeartPop .6s ease-out 1;
  }

  .big-heart-shell::before,
  .big-heart-shell::after{
    content:""; position:absolute; top:0;
    width:50%; height:90%;
    background:linear-gradient(145deg,#ff1493,#ff69b4,#ff1493);
    border-radius:50% 50% 0 0 / 55% 55% 0 0;
    box-shadow:none;
    filter:brightness(1.06);
  }
  .big-heart-shell::before{ left:50%; transform-origin:0 100%; transform:rotate(-45deg) }
  .big-heart-shell::after{ left:0;   transform-origin:100% 100%; transform:rotate(45deg) }

  @keyframes bigHeartFloat{
    0%,100%{ transform:translate(-50%,-50%) scale(1) rotate(0) }
    25%{    transform:translate(calc(-50%), calc(-50% - 10px)) scale(1.02) rotate(1deg) }
    50%{    transform:translate(-50%,-50%) scale(1) rotate(0) }
    75%{    transform:translate(calc(-50%), calc(-50% - 5px)) scale(1.01) rotate(-1deg) }
  }
  @keyframes bigHeartPop{
    0%{ transform:translate(-50%,-50%) scale(.88) }
    100%{ transform:translate(-50%,-50%) scale(1) }
  }

  /* TEXT INSIDE BIG HEART ‚Äî glowy */
  .big-heart-content{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    flex-direction:column;
    text-align:center; color:#fff;
    padding:24px 18px; width:100%; height:100%;
    z-index:10; box-sizing:border-box;
    overflow:auto;
    pointer-events:auto;
  }
  .big-heart-title{
    font-size:clamp(20px, 4vw, 22px);
    font-weight:800;
    margin:0 0 10px 0;
    letter-spacing:.3px;
    line-height:1.15;
    text-shadow: 0 0 6px rgba(255,255,255,.7), 0 0 14px rgba(255,105,180,.9), 0 0 28px rgba(255,105,180,.6);
    animation: neonPulse 2.2s ease-in-out infinite;
  }
  .big-heart-message{
    font-size:clamp(14px, 2.6vw, 18px);
    line-height:1.35;
    max-width:88%;
    margin:0 auto;
    text-shadow: 0 0 5px rgba(255,255,255,.7), 0 0 10px rgba(255,105,180,.8);
    animation: neonPulse 2.2s ease-in-out infinite;
    word-break:break-word;
    hyphens:auto;
  }

  .close-heart{
    position:absolute; top:15px; right:20px; background:rgba(255,255,255,.22);
    border:2px solid rgba(255,255,255,.55); border-radius:50%; width:44px; height:44px;
    display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:20px; color:white;
    transition:all .3s ease; backdrop-filter:blur(10px); z-index:15; outline:none;
    pointer-events:auto;
  }
  .close-heart:hover{ background:rgba(255,255,255,.32); transform:scale(1.1) rotate(90deg) }
  .close-heart:focus{ box-shadow:0 0 0 3px rgba(255,255,255,.45); }

  /* Corner sunflowers */
  .corners{position:fixed; inset:0; pointer-events:none; z-index:10}
  .corner-flower{position:absolute; font-size:clamp(50px,10vw,100px); opacity:.5; filter:drop-shadow(0 0 8px rgba(255,255,0,.5)); transition:all .3s ease;}
  .corner-flower:hover{ transform:scale(1.2) rotate(180deg)!important; opacity:.8 }
  .tl{top:20px;left:20px;transform:rotate(-15deg); animation:flowerSway1 6s ease-in-out infinite} 
  .tr{top:20px;right:20px;transform:rotate(15deg); animation:flowerSway2 7s ease-in-out infinite}
  .bl{bottom:20px;left:20px;transform:rotate(12deg); animation:flowerSway3 5s ease-in-out infinite} 
  .br{bottom:20px;right:20px;transform:rotate(-10deg); animation:flowerSway4 8s ease-in-out infinite}
  @keyframes flowerSway1{0%,100%{transform:rotate(-15deg) scale(1)}25%{transform:rotate(-10deg) scale(1.1)}50%{transform:rotate(-20deg) scale(1)}75%{transform:rotate(-5deg) scale(1.05)}}
  @keyframes flowerSway2{0%,100%{transform:rotate(15deg) scale(1)}33%{transform:rotate(20deg) scale(1.05)}66%{transform:rotate(10deg) scale(1.1)}}
  @keyframes flowerSway3{0%,100%{transform:rotate(12deg) scale(1)}40%{transform:rotate(17deg) scale(1.08)}80%{transform:rotate(7deg) scale(1.02)}}
  @keyframes flowerSway4{0%,100%{transform:rotate(-10deg) scale(1)}20%{transform:rotate(-5deg) scale(1.06)}60%{transform:rotate(-15deg) scale(1.03)}}

  /* Magic particles */
  .magic-particle{position:absolute; width:4px; height:4px; background:radial-gradient(circle,#ff69b4,transparent); border-radius:50%; pointer-events:none; animation:magicFloat 3s ease-out forwards}
  @keyframes magicFloat{0%{transform:translateY(0) scale(1); opacity:1}100%{transform:translateY(-100px) scale(0); opacity:0}}

  /* Confetti Canvas */
  #confettiCanvas{position:fixed; top:0; left:0; pointer-events:none; z-index:9999}

  /* Glitch */
  @keyframes glitch{0%{transform:translateX(0)}20%{transform:translateX(-2px) rotateX(1deg)}40%{transform:translateX(2px) rotateY(1deg)}60%{transform:translateX(-1px) rotateX(-1deg)}80%{transform:translateX(1px) rotateY(-1deg)}100%{transform:translateX(0)}}

  /* Mobile tweaks */
  @media (max-width:1200px){
    h1{font-size:1.8rem; margin:20px 15px 10px}
    button{font-size:1.1rem; padding:12px 24px}
    .message{font-size:1.2rem; margin-top:15px}
    .heart-container{width:320px; height:360px; bottom:100px}
    .heart-shell{width:320px; height:288px}
    .heart-shell::before,.heart-shell::after{width:160px; height:256px; border-radius:160px 160px 0 0}
    .heart-shell::before{left:160px}
    .note{width:280px; height:320px; padding:25px}
    .note-content{font-size:18px}
    .note-content h3{font-size:22px; margin-bottom:20px}
    .paper-tip-indicator{font-size:16px; top:-45px}
    .big-heart-title{font-size:clamp(18px,4vw,18px)}
    .big-heart-message{font-size:clamp(14px,3vw,16px)}
  }
</style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>
  
  <!-- Background music for Yes -->
  <audio id="backgroundMusic" loop>
    <source src="Albumaty.Com_tww_lyt_naryn.mp3" type="audio/mp3">
  </audio>

  <!-- Sound effect for No button -->
  <audio id="noSound" preload="auto">
    <source src="Omarfarag.mp3" type="audio/mp3">
    <!-- You can replace with any sound URL or local file -->
  </audio>

  <h1 id="question" class="glow">Habuba, will you be my birthday girl forever?üéÇüíñ</h1>

  <div class="buttons">
    <button id="yesBtn" class="glow">Yes üéâ</button>
    <button id="noBtn" class="glow">No üò¢</button>
  </div>

  <div class="message glow" id="message"></div>

  <!-- Bottom heart -->
  <div class="heart-container" id="heartContainer">
    <div class="heart-shell" id="heartShell">
      <div class="paper-tip-indicator">Click to open! üíñ</div>
    </div>
    <div class="note" id="note">
      <div class="note-content">
        <h3>üíå Happy Birthday, Habuba!</h3>
        <p>May your day be filled with love, joy, and endless happiness! üéâ</p>
        <p><small><em>You make every day magical! ‚ú®</em></small></p>
      </div>
    </div>
  </div>

  <!-- Big heart overlay (adds blur when active) -->
  <div class="big-heart-overlay" id="bigHeartOverlay" role="dialog" aria-modal="true" aria-labelledby="bigHeartTitle">
    <div class="big-heart-shell">
      <div class="close-heart" id="closeHeart" aria-label="Close" tabindex="0">√ó</div>
      <div class="big-heart-content">
        <div class="big-heart-title" id="bigHeartTitle">üíñ Happy Birthday! üíñ</div>
        <div class="big-heart-message">
          My dearest Habuba,<br>
          On this special day, I wish you all the love, joy, and magical moments your heart can hold.<br>
          You make every day brighter! ‚ú®<br>
          <strong>Forever yours üíï</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- Corner sunflowers -->
  <div class="corners" aria-hidden="true">
    <div class="corner-flower tl">üåª</div>
    <div class="corner-flower tr">üåª</div>
    <div class="corner-flower bl">üåª</div>
    <div class="corner-flower br">üåª</div>
  </div>

<script>
  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');
  const question = document.getElementById('question');
  const message = document.getElementById('message');
  const heartContainer = document.getElementById('heartContainer');
  const heartShell = document.getElementById('heartShell');
  const note = document.getElementById('note');
  const bigHeartOverlay = document.getElementById('bigHeartOverlay');
  const closeHeart = document.getElementById('closeHeart');
  const backgroundMusic = document.getElementById('backgroundMusic');
  const noSound = document.getElementById('noSound');

  let noClicks = 0;
  let noteOpened = false;

  // Start music function - only called when Yes is clicked
  function startMusic() {
    backgroundMusic.volume = 0.3;
    backgroundMusic.play().catch(e => {
      console.log('Could not play music:', e);
    });
  }

  // Play No sound effect
  function playNoSound() {
    noSound.currentTime = 0; // Reset to beginning
    noSound.volume = 1; // 50% volume
    noSound.play().catch(e => {
      console.log('Could not play no sound:', e);
      // Fallback: create a simple beep sound using Web Audio API
      createBeepSound();
    });
  }

  // Fallback beep sound using Web Audio API
  function createBeepSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800; // Frequency in Hz
      oscillator.type = 'square'; // Type of sound wave
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    } catch (e) {
      console.log('Could not create beep sound:', e);
    }
  }

  // Confetti setup
  const confettiCanvas = document.getElementById("confettiCanvas");
  const ctx = confettiCanvas.getContext("2d");
  let confettiPieces = [];

  function resizeCanvas() {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  // Interactive background - click to create magic particles
  document.addEventListener('click', (e) => {
    if (!e.target.closest('button') && !e.target.closest('.heart-shell') && 
        !e.target.closest('.big-heart-overlay')) {
      createMagicParticles(e.clientX, e.clientY);
    }
  });

  function createMagicParticles(x, y) {
    for (let i = 0; i < 8; i++) {
      const particle = document.createElement('div');
      particle.className = 'magic-particle';
      particle.style.left = (x - 2) + 'px';
      particle.style.top = (y - 2) + 'px';
      particle.style.animationDelay = (i * 100) + 'ms';
      document.body.appendChild(particle);
      setTimeout(() => particle.remove(), 3000);
    }
  }

  // Heart rain with start/stop control
  let heartRainInterval = null;
  function startHeartRain(){
    const spawn=()=>{
      const heart=document.createElement('div'); 
      heart.className='heart-rain';
      const size=12+Math.random()*25; 
      heart.style.width=size+'px'; 
      heart.style.height=size+'px';
      heart.style.left=Math.random()*100+'vw'; 
      heart.style.animationDuration=2+Math.random()*4+'s';
      const colors=['#ff7eb6','#ff3b3b','#ff69b4','#ff1493','#ffd6e9'];
      heart.style.background=colors[Math.floor(Math.random()*colors.length)]; 
      document.body.appendChild(heart);
      setTimeout(()=>heart.remove(),8000);
    };
    for(let i=0;i<50;i++) setTimeout(spawn,i*40); 
    heartRainInterval = setInterval(spawn,140);
  }
  function stopHeartRain(){
    if(heartRainInterval){ clearInterval(heartRainInterval); heartRainInterval=null; }
    document.querySelectorAll('.heart-rain').forEach(h=>h.remove());
  }

  // Button interactions
  yesBtn.addEventListener('click', () => {
    // Start music only when Yes is clicked
    startMusic();
    
    yesBtn.remove(); 
    noBtn.remove(); 
    question.textContent = "";
    message.textContent = "         ";
    heartContainer.style.display = 'block';
    startHeartRain();
  });

  noBtn.addEventListener('click', () => {
    // Play sound effect when No is clicked
    
    noClicks++;
    createMagicParticles(
      noBtn.getBoundingClientRect().left + noBtn.offsetWidth/2,
      noBtn.getBoundingClientRect().top + noBtn.offsetHeight/2
    );
    if (noClicks === 1) {
          playNoSound();

      question.textContent = "üíî!ÿ®ÿ¨ÿØ ŸàÿßŸÑŸÑŸá";
      question.style.color = '#ffeb3b';
    } else if (noClicks === 2) {
      question.textContent = "ÿßŸÖÿ≥ŸÉŸä ÿßŸÑÿπŸÇŸÑ Ÿäÿ®ŸÜÿ™Ÿä ŸÅŸÉÿ±Ÿä ÿ™ÿßŸÜŸä";
      question.style.color = '#ff9800';
      moveButtonRandomly(noBtn);
    } else if (noClicks === 3) {
      question.textContent = "ü§®Ÿäÿß ÿ≠ÿ®Ÿàÿ®Ÿá Ÿáÿ™ŸÜÿØŸÖŸä ŸÖŸÅŸäÿ¥ ÿ≠ÿØ ŸáŸäÿØŸÑÿπŸÉ ÿ≤Ÿä ŸÖÿß ÿ®ÿØŸÑÿπŸÉ";
      question.style.color = '#ff5722';
      moveButtonRandomly(noBtn);
      document.querySelectorAll('.corner-flower').forEach(flower => {
        flower.style.animationDuration = '1s';
      });
    } else if (noClicks === 4) {
      document.body.style.animation = 'glitch 0.3s infinite';
      question.textContent = "üòÇŸÖÿß ŸáŸà ŸÖÿ¥ ÿßŸàÿ®ÿ¥ŸÜ";
      question.style.color = '#f44336';
      startHeartRain();
    } else {
      noBtn.remove(); 
      question.textContent = "üòàŸÉÿßŸÜ ŸÜŸÅÿ≥Ÿä ŸÖÿ≥ÿ™ÿÆÿØŸÖÿ¥ ÿßŸÑÿπŸÜŸÅ Ÿàÿ±ŸäŸÜŸä Ÿáÿ™ÿÆÿ™ÿßÿ±Ÿä ŸÑÿßÿ° ÿßÿ≤ÿßŸä ÿ®ŸÇÿß ";
      question.style.color = '#e91e63';
      yesBtn.style.animation = 'heartbeat 1s infinite';
    }
  });

  function moveButtonRandomly(button){
    const w = button.offsetWidth, h = button.offsetHeight;
    const x = Math.random() * (window.innerWidth - w - 20);
    const y = Math.random() * (window.innerHeight - h - 20);
    button.style.position='absolute'; 
    button.style.left = `${x}px`; 
    button.style.top  = `${y}px`;
    button.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
  }

  // Heart click
  let injectedOnce = false;
  heartShell.addEventListener('click', () => {
    noteOpened = !noteOpened;
    note.classList.toggle('open', noteOpened);
    if (noteOpened) {
      if(!injectedOnce){
        setBigHeartMessage(
          `Habubty‚ù§Ô∏è<br>
           Happy Birthday, ya Habibty üéâ<br>
          Ah mn3rf4 ba3d b2alna kteer bas ana awl ma 4oft ayoonk at4adetlk w w23t kda w a5r fatra kont mtl8bt m4 areef a3ml eh wla eh ra8m kol haga bthsl bt2flny mnk bas alhaga alwahrda ally mot2kd mnha ane bhbk w m4 ayez banota 8erk f hyaty <br>
          W Ayzek bta3ty ana w bas<br>
          
            <br>
          Anty Bta3tyyüòâ<br><br>
           <strong>Haubty‚ù§Ô∏è</strong>`,
          false // set true to force RTL
        );
        injectedOnce = true;
      }
      burstConfetti(heartShell);
      setTimeout(() => openBigHeart(), 800);
    }
  });

  // Big heart open/close ‚Äî overlay blurs background
  function openBigHeart(){
    document.body.style.overflow = 'hidden';
    stopHeartRain();
    bigHeartOverlay.classList.add('active');  // <-- triggers backdrop blur
    setTimeout(()=>createMagicParticles(window.innerWidth/2, window.innerHeight/2), 500);
  }
  function closeBigHeart(){
    document.body.style.overflow = '';
    bigHeartOverlay.classList.remove('active');
    startHeartRain();
  }
  document.getElementById('closeHeart').addEventListener('click', closeBigHeart);
  bigHeartOverlay.addEventListener('click', (e)=>{ if(e.target===bigHeartOverlay) closeBigHeart() });

  // Make close button keyboard-friendly
  closeHeart.addEventListener('keydown', (e)=>{
    if(e.key==='Enter' || e.key===' '){ e.preventDefault(); closeBigHeart(); }
  });

  // Confetti
  function burstConfetti(elem){
    const rect=elem.getBoundingClientRect();
    const centerX=rect.left+rect.width/2;
    const centerY=rect.top+rect.height/2;
    for(let i=0;i<120;i++){
      confettiPieces.push({
        x:centerX,y:centerY,r:Math.random()*8+3,
        c: `hsl(${Math.random()*360},100%,50%)`,
        vx:(Math.random()-.5)*8, vy:Math.random()*-8-4, a:1, gravity:.1
      });
    }
  }
  function drawConfetti(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    confettiPieces.forEach((p,i)=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity; p.a-=.008;
      ctx.globalAlpha=p.a; ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      if(p.a<=0 || p.y>confettiCanvas.height) confettiPieces.splice(i,1);
    });
    requestAnimationFrame(drawConfetti);
  }
  drawConfetti();

  // Keys
  document.addEventListener('keydown',(e)=>{
    if((e.key==='Enter'||e.key===' ') && document.body.contains(yesBtn)) yesBtn.click();
    else if(e.key==='Escape' && bigHeartOverlay.classList.contains('active')) closeBigHeart();
    else if((e.key==='h'||e.key==='H') && heartContainer.style.display!=='none') heartShell.click();
  });

  // Subtle particles on load
  setTimeout(()=>{
    for(let i=0;i<15;i++){
      setTimeout(()=>createMagicParticles(Math.random()*window.innerWidth, Math.random()*window.innerHeight), i*300);
    }
  },1000);

  // Helper: set message + RTL/LTR
  function setBigHeartMessage(html, isArabic=false){
    const box = document.querySelector('.big-heart-message');
    box.innerHTML = html;
    box.setAttribute('dir', isArabic ? 'rtl' : 'ltr');
  }

</script>
</body>
</html>
